<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AVD Tools</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root {
      --bg:#0f172a; --card:#0b1224; --panel:#0b1224; --border:#1e293b;
      --text:#e5e7eb; --muted:#94a3b8; --accent:#38bdf8; --accent-soft:rgba(56,189,248,0.15);
    }
    @media (prefers-color-scheme: light) {
      :root {
        --bg:#f8fafc; --card:#ffffff; --panel:#ffffff; --border:#e5e7eb;
        --text:#0f172a; --muted:#475569; --accent:#0ea5e9; --accent-soft:rgba(14,165,233,0.15);
      }
    }
    * { box-sizing:border-box; }
    body {
      margin:0; padding:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
      min-height:100vh;
      background:
        radial-gradient(800px 500px at 10% 0%, rgba(56,189,248,0.12), transparent 50%),
        radial-gradient(800px 500px at 90% 0%, rgba(129,140,248,0.10), transparent 50%),
        var(--bg);
    }
    .wrap { max-width: 1100px; margin:0 auto; padding:20px 16px 32px; }
    header { display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
    h1 { margin:0; font-size:26px; letter-spacing:.02em; }
    .muted { color:var(--muted); font-size:14px; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:18px; padding:16px; box-shadow:0 18px 36px rgba(15,23,42,0.4); }
    .controls { display:flex; gap:10px; flex-wrap:wrap; margin-top:14px; }
    input[type="search"] {
      flex:1; min-width:240px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:var(--panel);
      color:var(--text);
    }
    .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(260px,1fr)); gap:12px; margin-top:16px; }
    .tool-card { border:1px solid var(--border); border-radius:14px; padding:14px; background:var(--panel); display:flex; flex-direction:column; gap:8px; transition: border-color .12s ease, transform .08s ease, box-shadow .12s ease; }
    .tool-card:hover { border-color:var(--accent); transform:translateY(-1px); box-shadow:0 10px 24px rgba(15,23,42,0.35); }
    .tool-head { display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .code-pill { font-size:11px; padding:3px 8px; border-radius:999px; border:1px solid var(--border); background:var(--accent-soft); color:var(--text); }
    a.tool-link { color:var(--text); text-decoration:none; }
    a.tool-link:focus-visible { outline:2px solid var(--accent); outline-offset:3px; border-radius:12px; }
    .empty { margin-top:16px; color:var(--muted); font-size:14px; }
    .meta { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .meta a { color:var(--accent); text-decoration:none; font-size:13px; }
    .meta a:hover { text-decoration:underline; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>AVD Tools</h1>
        <div class="muted">Unified home for all AVD single-page tools (self-contained index.html per tool).</div>
      </div>
      <div class="meta">
        <a href="./CODEX.md">Root CODEX</a>
        <a href="./AVD-UI-CORE.md">AVD UI Core</a>
      </div>
    </header>

    <div class="card" style="margin-top:16px;">
      <div class="controls">
        <input type="search" id="searchInput" placeholder="Search by name, code, or description" aria-label="Filter tools" />
      </div>
      <div id="toolsGrid" class="grid" aria-live="polite"></div>
      <div id="emptyState" class="empty" style="display:none;">No tools match your search.</div>
    </div>
  </div>

  <script>
    const state = { tools: [], filtered: [] };

    function renderTools() {
      const grid = document.getElementById('toolsGrid');
      const empty = document.getElementById('emptyState');
      grid.innerHTML = '';

      if (!state.filtered.length) {
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';

      state.filtered.forEach(tool => {
        const card = document.createElement('a');
        card.className = 'tool-card tool-link';
        card.href = tool.path;
        card.setAttribute('data-code', tool.code);
        card.setAttribute('data-name', tool.name);

        card.innerHTML = `
          <div class="tool-head">
            <div>
              <div style="font-weight:700; font-size:15px;">${tool.name}</div>
              <div class="muted" style="font-size:12px; margin-top:2px;">${tool.description || ''}</div>
            </div>
            <span class="code-pill" aria-label="Tool code">${tool.code}</span>
          </div>
        `;

        grid.appendChild(card);
      });
    }

    function applyFilter() {
      const term = (document.getElementById('searchInput').value || '').toLowerCase();
      if (!term) {
        state.filtered = [...state.tools];
      } else {
        state.filtered = state.tools.filter(t =>
          (t.name || '').toLowerCase().includes(term) ||
          (t.code || '').toLowerCase().includes(term) ||
          (t.description || '').toLowerCase().includes(term)
        );
      }
      renderTools();
    }

    async function loadManifest() {
      try {
        const res = await fetch('tools.json', { cache: 'no-cache' });
        if (!res.ok) throw new Error('Manifest fetch failed: ' + res.status);
        const data = await res.json();
        state.tools = Array.isArray(data) ? data : (data.tools || []);
        state.filtered = [...state.tools];
        renderTools();
      } catch (e) {
        const grid = document.getElementById('toolsGrid');
        const empty = document.getElementById('emptyState');
        grid.innerHTML = '';
        empty.style.display = 'block';
        empty.textContent = 'Unable to load tools manifest. ' + (e.message || e);
      }
    }

    document.getElementById('searchInput').addEventListener('input', applyFilter);
    loadManifest();
  </script>
</body>
</html>
